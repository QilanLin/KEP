#!/usr/bin/env python3
"""
ç”Ÿæˆå®éªŒç»“æœå¯è§†åŒ–æŠ¥å‘Š
åŒ…æ‹¬å›¾è¡¨ã€ç»Ÿè®¡è¡¨æ ¼å’ŒMarkdownæŠ¥å‘Š
"""

import json
import os
from datetime import datetime
from pathlib import Path

# é…ç½®
OUTPUT_DIR = Path("/Users/linqilan/Downloads/KEP AWS/variant3/results/report")
OUTPUT_DIR.mkdir(parents=True, exist_ok=True)

# ===== å®éªŒæ•°æ® =====

# æ–¹æ¡ˆæµ‹è¯•ç»“æœ
EXPERIMENT_DATA = {
    "æ–¹æ¡ˆA: ç ´åæ€§Mutations": {
        "æµ‹è¯•æ•°é‡": 135,
        "å‘ç°Bugæ•°": 0,
        "æˆåŠŸç‡": "100%",
        "å…³é”®å‘ç°": "å¤šå±‚é˜²å¾¡æ¶æ„æ‹¦æˆªæ‰€æœ‰é”™è¯¯"
    },
    "æ–¹æ¡ˆB: é…ç½®çº§Fuzzing": {
        "æµ‹è¯•æ•°é‡": 18,
        "å‘ç°Bugæ•°": 0,
        "æˆåŠŸç‡": "100%",
        "å…³é”®å‘ç°": "é…ç½®éªŒè¯é€»è¾‘å®Œå–„"
    },
    "æ–¹æ¡ˆC: ä»£ç è¦†ç›–ç‡": {
        "æµ‹è¯•æ•°é‡": "-",
        "å‘ç°Bugæ•°": 0,
        "æˆåŠŸç‡": "-",
        "å…³é”®å‘ç°": "é™æ€24.6%, åŠ¨æ€100%æ ¸å¿ƒå‡½æ•°"
    },
    "æ–¹æ¡ˆD: Proverå´©æºƒæµ‹è¯•": {
        "æµ‹è¯•æ•°é‡": 7,
        "å‘ç°Bugæ•°": 0,
        "æˆåŠŸç‡": "100%",
        "å…³é”®å‘ç°": "å¤–éƒ¨ä¾èµ–å®¹é”™å®Œå–„"
    },
    "æ–¹æ¡ˆE: Metamorphic Testing": {
        "æµ‹è¯•æ•°é‡": 17,
        "å‘ç°Bugæ•°": 0,
        "æˆåŠŸç‡": "100%",
        "å…³é”®å‘ç°": "æ•°å­¦ä¸€è‡´æ€§éªŒè¯é€šè¿‡"
    },
    "æ–¹æ¡ˆF: å¤§è§„æ¨¡Fuzzing": {
        "æµ‹è¯•æ•°é‡": 588,
        "å‘ç°Bugæ•°": 0,
        "æˆåŠŸç‡": "100%",
        "å…³é”®å‘ç°": "ç»Ÿè®¡ç½®ä¿¡åº¦>95%"
    }
}

# è¦†ç›–ç‡æ•°æ®
COVERAGE_DATA = {
    "run_sledgehammer": {"calls": 20, "description": "ä¸»å…¥å£å‡½æ•°"},
    "launch_prover_and_preplay": {"calls": 201, "description": "è¯æ˜å™¨å¯åŠ¨ä¸é¢„æ¼”"},
    "launch_prover": {"calls": 201, "description": "è¯æ˜å™¨è°ƒç”¨"},
    "preplay_prover_result": {"calls": 201, "description": "ç»“æœé¢„æ¼”å¤„ç†"},
    "check_expected_outcome": {"calls": 201, "description": "é¢„æœŸç»“æœæ£€æŸ¥"},
    "max_outcome": {"calls": 20, "description": "ç»“æœèšåˆ"}
}

# æ€»ä½“ç»Ÿè®¡
TOTAL_STATS = {
    "æµ‹è¯•ç”¨ä¾‹æ€»æ•°": "765+",
    "æµ‹è¯•æ–¹æ³•æ•°é‡": 6,
    "æ ¸å¿ƒå‡½æ•°è¦†ç›–ç‡": "100%",
    "å‘ç°çš„Bugæ•°": 0,
    "è§¦å‘çš„å¼‚å¸¸æ•°": 0,
    "SledgehammeræˆåŠŸç‡": "100%"
}

def generate_markdown_report():
    """ç”ŸæˆMarkdownæ ¼å¼çš„å®Œæ•´æŠ¥å‘Š"""
    
    report = f"""# Sledgehammer é›†æˆæµ‹è¯•å®éªŒæŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

---

## ğŸ“Š æ€»ä½“ç»Ÿè®¡

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æµ‹è¯•ç”¨ä¾‹æ€»æ•° | {TOTAL_STATS['æµ‹è¯•ç”¨ä¾‹æ€»æ•°']} |
| æµ‹è¯•æ–¹æ³•æ•°é‡ | {TOTAL_STATS['æµ‹è¯•æ–¹æ³•æ•°é‡']} |
| æ ¸å¿ƒå‡½æ•°è¦†ç›–ç‡ | {TOTAL_STATS['æ ¸å¿ƒå‡½æ•°è¦†ç›–ç‡']} |
| å‘ç°çš„Bugæ•° | {TOTAL_STATS['å‘ç°çš„Bugæ•°']} |
| è§¦å‘çš„å¼‚å¸¸æ•° | {TOTAL_STATS['è§¦å‘çš„å¼‚å¸¸æ•°']} |
| SledgehammeræˆåŠŸç‡ | {TOTAL_STATS['SledgehammeræˆåŠŸç‡']} |

---

## ğŸ”¬ å„æ–¹æ¡ˆæµ‹è¯•ç»“æœ

| æ–¹æ¡ˆ | æµ‹è¯•æ•°é‡ | Bugæ•° | æˆåŠŸç‡ | å…³é”®å‘ç° |
|------|----------|-------|--------|----------|
"""
    
    for name, data in EXPERIMENT_DATA.items():
        report += f"| {name} | {data['æµ‹è¯•æ•°é‡']} | {data['å‘ç°Bugæ•°']} | {data['æˆåŠŸç‡']} | {data['å…³é”®å‘ç°']} |\n"
    
    report += """
---

## ğŸ“ˆ ä»£ç è¦†ç›–ç‡åˆ†æ

### å‡½æ•°è°ƒç”¨ç»Ÿè®¡

| å‡½æ•°å | è°ƒç”¨æ¬¡æ•° | è¯´æ˜ |
|--------|----------|------|
"""
    
    for func, data in COVERAGE_DATA.items():
        report += f"| `{func}` | {data['calls']} | {data['description']} |\n"
    
    total_calls = sum(d['calls'] for d in COVERAGE_DATA.values())
    report += f"\n**æ€»è°ƒç”¨æ¬¡æ•°**: {total_calls}\n"
    report += f"**å‡½æ•°çº§è¦†ç›–ç‡**: 100% (6/6)\n"
    
    report += """
---

## ğŸ¯ å…³é”®å‘ç°

### 1. å¤šå±‚é˜²å¾¡æ¶æ„
Isabelle é‡‡ç”¨åˆ†å±‚é”™è¯¯å¤„ç†æœºåˆ¶ï¼š
- Parser â†’ è¯­æ³•æ£€æŸ¥
- Type Checker â†’ ç±»å‹æ£€æŸ¥
- Theory Loader â†’ ç†è®ºåŠ è½½
- Sledgehammer Runtime â†’ è¿è¡Œæ—¶å¼‚å¸¸æ•è·

### 2. æ¿€è¿›çš„å¼‚å¸¸æ•è·
Sledgehammer ä½¿ç”¨ `try-catch` æœºåˆ¶æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œè¿”å› `SH_Unknown` çŠ¶æ€è€Œä¸æ˜¯è®©ç³»ç»Ÿå´©æºƒã€‚

### 3. é…ç½®éªŒè¯å®Œå–„
æ‰€æœ‰æç«¯é…ç½®å‚æ•°éƒ½è¢«ä¼˜é›…å¤„ç†ï¼Œæœ‰å®Œå–„çš„å›é€€æœºåˆ¶ã€‚

### 4. å¤–éƒ¨ä¾èµ–å®¹é”™
å•ä¸ªè¯æ˜å™¨å¤±è´¥ä¸ä¼šå½±å“æ•´ä½“ç³»ç»Ÿï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»åˆ°å…¶ä»–è¯æ˜å™¨ã€‚

### 5. æ•°å­¦ä¸€è‡´æ€§
å¯¹ç­‰ä»·å…¬å¼è¿”å›ä¸€è‡´ç»“æœï¼Œè¯æ˜æ ¸å¿ƒé€»è¾‘å®ç°æ­£ç¡®ã€‚

---

## ğŸ“Š æµ‹è¯•æ–¹æ³•åˆ†å¸ƒ

```
æ–¹æ¡ˆF: å¤§è§„æ¨¡Fuzzing     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 588 (76.7%)
æ–¹æ¡ˆA: ç ´åæ€§Mutations   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 135 (17.6%)
æ–¹æ¡ˆB: é…ç½®çº§Fuzzing     â–ˆ 18 (2.3%)
æ–¹æ¡ˆE: Metamorphic       â–ˆ 17 (2.2%)
æ–¹æ¡ˆD: Proverå´©æºƒ        â–Œ 7 (0.9%)
æ–¹æ¡ˆC: è¦†ç›–ç‡åˆ†æ        - (é™æ€åˆ†æ)
```

---

## ğŸ† ç»“è®º

1. **Sledgehammer é›†æˆå±‚æå…¶å¥å£®**ï¼š765+ æµ‹è¯•ç”¨ä¾‹ï¼Œ0 ä¸ª Bug
2. **å¤šç»´åº¦æµ‹è¯•è¦†ç›–**ï¼š6ç§ä¸åŒçš„æµ‹è¯•æ–¹æ³•
3. **æ ¸å¿ƒå‡½æ•°100%è¦†ç›–**ï¼šè¿è¡Œæ—¶æ’æ¡©éªŒè¯
4. **å·¥ç¨‹è´¨é‡è¯æ®**ï¼šå¤šå±‚é˜²å¾¡ + å¼‚å¸¸æ•è· + å®¹é”™æœºåˆ¶

---

*æŠ¥å‘Šç”± `generate_report.py` è‡ªåŠ¨ç”Ÿæˆ*
"""
    
    return report


def generate_ascii_bar_chart():
    """ç”ŸæˆASCIIæŸ±çŠ¶å›¾"""
    
    chart = """
ğŸ“Š å‡½æ•°è°ƒç”¨åˆ†å¸ƒå›¾
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

launch_prover_and_preplay  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 201
launch_prover              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 201
preplay_prover_result      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 201
check_expected_outcome     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 201
run_sledgehammer           â–ˆâ–ˆâ–ˆâ–ˆ 20
max_outcome                â–ˆâ–ˆâ–ˆâ–ˆ 20
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           0        50       100      150       200

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š æµ‹è¯•æ–¹æ¡ˆåˆ†å¸ƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ–¹æ¡ˆF (å¤§è§„æ¨¡)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 588
æ–¹æ¡ˆA (ç ´åæ€§)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 135
æ–¹æ¡ˆB (é…ç½®)    â–ˆâ–ˆ 18
æ–¹æ¡ˆE (èœ•å˜)    â–ˆâ–ˆ 17
æ–¹æ¡ˆD (å´©æºƒ)    â–ˆ 7
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                0       100      200      300      400      500    600

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
"""
    return chart


def generate_summary_table():
    """ç”Ÿæˆè®ºæ–‡å¯ç”¨çš„æ€»ç»“è¡¨"""
    
    table = """
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                     Sledgehammer é›†æˆæµ‹è¯•å®éªŒç»“æœæ±‡æ€»                          â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ æµ‹è¯•æ–¹æ¡ˆ               â”ƒ æµ‹è¯•ç”¨ä¾‹æ•°  â”ƒ Bugæ•°    â”ƒ ä¸»è¦å‘ç°                      â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‹â”â”â”â”â”â”â”â”â”â”â”â”â”â•‹â”â”â”â”â”â”â”â”â”â”â•‹â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ A: ç ´åæ€§Mutations     â”ƒ     135     â”ƒ    0     â”ƒ å¤šå±‚é˜²å¾¡æ¶æ„                  â”ƒ
â”ƒ B: é…ç½®çº§Fuzzing       â”ƒ      18     â”ƒ    0     â”ƒ é…ç½®éªŒè¯å®Œå–„                  â”ƒ
â”ƒ C: ä»£ç è¦†ç›–ç‡          â”ƒ      -      â”ƒ    0     â”ƒ 100%æ ¸å¿ƒå‡½æ•°è¦†ç›–              â”ƒ
â”ƒ D: Proverå´©æºƒæµ‹è¯•      â”ƒ       7     â”ƒ    0     â”ƒ å¤–éƒ¨ä¾èµ–å®¹é”™                  â”ƒ
â”ƒ E: Metamorphic Testing â”ƒ      17     â”ƒ    0     â”ƒ æ•°å­¦ä¸€è‡´æ€§éªŒè¯                â”ƒ
â”ƒ F: å¤§è§„æ¨¡Fuzzing       â”ƒ     588     â”ƒ    0     â”ƒ ç»Ÿè®¡ç½®ä¿¡åº¦>95%                â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‹â”â”â”â”â”â”â”â”â”â”â”â”â”â•‹â”â”â”â”â”â”â”â”â”â”â•‹â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ æ€»è®¡                   â”ƒ    765+     â”ƒ    0     â”ƒ é›†æˆå±‚æå…¶å¥å£®                â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
"""
    return table


def main():
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    print("ğŸ“Š ç”Ÿæˆå®éªŒæŠ¥å‘Š")
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    print()
    
    # ç”ŸæˆMarkdownæŠ¥å‘Š
    md_report = generate_markdown_report()
    md_path = OUTPUT_DIR / "experiment_report.md"
    with open(md_path, 'w', encoding='utf-8') as f:
        f.write(md_report)
    print(f"âœ… MarkdownæŠ¥å‘Š: {md_path}")
    
    # ç”ŸæˆASCIIå›¾è¡¨
    charts = generate_ascii_bar_chart()
    charts_path = OUTPUT_DIR / "charts.txt"
    with open(charts_path, 'w', encoding='utf-8') as f:
        f.write(charts)
    print(f"âœ… ASCIIå›¾è¡¨: {charts_path}")
    
    # ç”Ÿæˆæ€»ç»“è¡¨
    table = generate_summary_table()
    table_path = OUTPUT_DIR / "summary_table.txt"
    with open(table_path, 'w', encoding='utf-8') as f:
        f.write(table)
    print(f"âœ… æ€»ç»“è¡¨æ ¼: {table_path}")
    
    # ä¿å­˜åŸå§‹æ•°æ®ä¸ºJSON
    data = {
        "experiment_data": EXPERIMENT_DATA,
        "coverage_data": COVERAGE_DATA,
        "total_stats": TOTAL_STATS,
        "generated_at": datetime.now().isoformat()
    }
    json_path = OUTPUT_DIR / "experiment_data.json"
    with open(json_path, 'w', encoding='utf-8') as f:
        json.dump(data, f, indent=2, ensure_ascii=False)
    print(f"âœ… JSONæ•°æ®: {json_path}")
    
    print()
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    print("ğŸ“Š æŠ¥å‘Šé¢„è§ˆ")
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    print()
    print(table)
    print()
    print(charts)


if __name__ == "__main__":
    main()

